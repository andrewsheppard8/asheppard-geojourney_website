<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Food & Drink Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- MapLibre -->
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      z-index: 1;
      font-family: sans-serif;
      font-size: 14px;
    }

    #ratingValue {
      font-weight: bold;
    }
  </style>
</head>

<body>

  <div id="controls">
    <label for="cuisineFilter">Cuisine:</label>
    <select id="cuisineFilter">
      <option value="All">All</option>
    </select>
    <br><br>
    <label for="ratingFilter">Min Rating: <span id="ratingValue">0</span></label><br>
    <input type="range" id="ratingFilter" min="0" max="5" step="0.1" value="0">
  </div>

  <div id="map"></div>

  <script>
    // Replace with your MapTiler key
    const API_KEY = "pV5qrUWfj8Cyn942dyn6";

    // Init MapLibre with MapTiler basemap
    const map = new maplibregl.Map({
      container: 'map',
      style: `https://api.maptiler.com/maps/streets/style.json?key=${API_KEY}`,
      center: [-122.42, 37.78], // SF as example
      zoom: 13
    });

    // Sample food locations with link + description
    const foodLocations = [
      {
        name: "Sushi House",
        cuisine: "Japanese",
        rating: 4.5,
        coords: [-122.42, 37.78],
        desc: "Fresh sushi and sashimi with a cozy vibe.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.78,-122.42"
      },
      {
        name: "Pasta Corner",
        cuisine: "Italian",
        rating: 4.2,
        coords: [-122.41, 37.79],
        desc: "Homemade pasta and classic Italian wines.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.79,-122.41"
      },
      {
        name: "Taco Fiesta",
        cuisine: "Mexican",
        rating: 4.0,
        coords: [-122.43, 37.77],
        desc: "Street tacos and margaritas that hit the spot.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.77,-122.43"
      },
      {
        name: "Cafe Delight",
        cuisine: "Cafe",
        rating: 4.8,
        coords: [-122.44, 37.78],
        desc: "Great coffee and pastries, perfect for remote work.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.78,-122.44"
      },
      {
        name: "Burger Hub",
        cuisine: "American",
        rating: 4.1,
        coords: [-122.40, 37.78],
        desc: "Big burgers, milkshakes, and late-night vibes.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.78,-122.40"
      },
      {
        name: "Noodle Spot",
        cuisine: "Asian Fusion",
        rating: 3.8,
        coords: [-122.39, 37.77],
        desc: "Mix of Asian street food, ramen, and fusion dishes.",
        link: "https://www.google.com/maps/dir/?api=1&destination=37.77,-122.39"
      }
    ];

    // Populate cuisine filter
    const cuisineSet = new Set(foodLocations.map(f => f.cuisine));
    const cuisineFilter = document.getElementById('cuisineFilter');
    cuisineSet.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      cuisineFilter.appendChild(opt);
    });

    // Rating slider
    const ratingFilter = document.getElementById('ratingFilter');
    const ratingValue = document.getElementById('ratingValue');
    ratingValue.textContent = ratingFilter.value;

    // Store markers
    let markers = [];

    function addMarkers(filterCuisine = "All", minRating = 0) {
      // Remove old markers
      markers.forEach(m => m.remove());
      markers = [];

      // Add filtered markers
      const filtered = foodLocations.filter(f =>
        (filterCuisine === "All" || f.cuisine === filterCuisine) &&
        f.rating >= minRating
      );

      filtered.forEach(loc => {
        const popup = new maplibregl.Popup({ offset: 25 })
          .setHTML(`
            <strong>${loc.name}</strong><br>
            Cuisine: ${loc.cuisine}<br>
            ‚≠ê ${loc.rating}<br>
            <em>${loc.desc}</em><br>
            <a href="${loc.link}" target="_blank">Get Directions</a>
          `);

        const marker = new maplibregl.Marker({ color: "#FF5722" })
          .setLngLat(loc.coords)
          .setPopup(popup)
          .addTo(map);

        markers.push(marker);
      });
    }

    // Add markers once map is loaded
    map.on('load', () => addMarkers());

    // Handle filter changes
    function updateFilters() {
      addMarkers(cuisineFilter.value, parseFloat(ratingFilter.value));
    }

    cuisineFilter.addEventListener('change', updateFilters);
    ratingFilter.addEventListener('input', () => {
      ratingValue.textContent = ratingFilter.value;
      updateFilters();
    });
  </script>

</body>

</html>